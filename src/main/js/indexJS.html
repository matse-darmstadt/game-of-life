<!DOCTYPE html>
<html>
<head>
	<title>Game of Life</title>
	<meta charset="UTF-8">
</head>
<body>
	<input type="text" id="address"/>
	<input type="button" onclick="openConnection()" value="Start Connection" />
	<input type="button" onclick="frequency+=1000; startLoop(); return false;" value="Send Data" />	
	<br/>
	<canvas id="output" width="800"></canvas>
	
	<script>

		
		var frequency = 5000;
		var interval = 0;
		var websocketTarget = '172.20.60.70' ;
		var port = '1234';
		
		var connection;
		var testText = 'Hello World';
		
		function startLoop() {
			if(interval > 0) clearInterval(interval);  
			interval = setInterval( sendWebsocket, frequency );  
		}

		function sendWebsocket(connection)
		{
			connection.send(testText);
		}
		
		function openConnection(connection) {
//			websocketTarget = document.getElementById('address').value;
// 			alert(websocketTarget + ":" + port);
			connection = new WebSocket('ws://' + websocketTarget + ':' + port);
			printOnScreen(connection.readyState);
			console.log(connection.readyState);
			
			connection.onopen = function () {
				connection.send(testText);
				console.log(connection.readyState);
				startLoop();
			};
		
			connection.onerror = function (error) {
				console.log('WebSocket Error ' + testText);
				printOnScreen("Error sending" + testText);
			};
				
			connection.onmessage = function (e) {
				console.log('Server: ' + e.data);
				printOnScreen('Server: ' + e.data);
			};
			
			connection.onclose = function() {
				console.log('Connection stopped...');
			}
			

		}
		
			
			
		
		
		function printOnScreen(text) {
			var canvas = document.getElementById("output");
			var context = canvas.getContext("2d");
			context.font = "30px Arial";
			context.fillText(text, 10, 50);
		}
		
		function WebSocketTest()
         {
            if ("WebSocket" in window)
            {
               alert("WebSocket is supported by your Browser!");
               
               // Let us open a web socket
               var ws = new WebSocket("ws://172.20.60.70:1234/");
				
               ws.onopen = function()
               {
                  // Web Socket is connected, send data using send()
                  ws.send("Message to send");
                  console.log("Message is sent...");
               };
				
               ws.onmessage = function (evt) 
               { 
                  var received_msg = evt.data;
                  console.log("Message is received...");
               };
				
               ws.onclose = function()
               { 
                  // websocket is closed.
                  console.log("Connection is closed..."); 
               };
            }
            
            else
            {
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }
         }
		

	</script>
</body>
</html>
